#!/usr/bin/env bash

[[ -z $1 ]] && echo "workflow type required." 1>&2 && exit 1
prefix=$1

if [[ "$2" = "finish" ]]
then
  if [[ -n $3 ]]
  then
    branch="$prefix"/$3
  else
    branch="$(git symbolic-ref --quiet HEAD)"
    [[ -z $branch ]] && branch="(unnamed branch)" || branch="$(git for-each-ref --format='%(refname:short)' $branch)"
    [[ $branch != $prefix/* && -n $branch ]] && echo "$1 <name> required." 1>&2 && exit 1
  fi
  git checkout master && git merge --no-ff $branch && git branch -D $branch
else
  [[ -z $2 ]] && echo "$1 <name> required." 1>&2 && exit 1
  [[ -n $3 ]] && echo "too many arguments; if not finishing a $1, only <name> of new $1 is expected" && exit 1
  branch="$prefix"/$2
  git checkout -b $branch
fi
